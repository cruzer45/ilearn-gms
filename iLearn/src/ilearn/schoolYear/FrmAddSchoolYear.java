/*
 * FrmAddSchoolYear.java
 *
 * Created on Jun 2, 2012, 7:59:03 AM
 */
package ilearn.schoolYear;

import ilearn.kernel.Utilities;
import java.util.Date;
import java.util.HashMap;
import org.jdesktop.application.Action;

/**
 *
 * @author mrogers
 */
public class FrmAddSchoolYear extends javax.swing.JInternalFrame
{

    String validationText = "";
    
    /** Creates new form FrmAddSchoolYear */
    public FrmAddSchoolYear()
    {
        initComponents();
        populateLists();
    }
    
    private void populateLists()
    {
        Date start = new Date(new Date().getYear(), 8, 1);
        calStart.setDate(start);
        Date end = new Date(new Date().getYear() + 1, 5, 30);
        calEnd.setDate(end);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        wrapperPanel = new javax.swing.JPanel();
        lblName = new javax.swing.JLabel();
        txtName = new javax.swing.JTextField();
        calStart = new com.toedter.calendar.JDateChooser();
        calEnd = new com.toedter.calendar.JDateChooser();
        cmdCancel = new javax.swing.JButton();
        cmdSave = new javax.swing.JButton();
        cmdReset = new javax.swing.JButton();
        lblStart = new javax.swing.JLabel();
        lblEnd = new javax.swing.JLabel();

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("Add School Year");
        setFrameIcon(new javax.swing.ImageIcon(getClass().getResource("/ilearn/resources/calendar_add.png"))); // NOI18N

        wrapperPanel.setName("wrapperPanel"); // NOI18N

        lblName.setText("Year Name:");
        lblName.setName("lblName"); // NOI18N

        txtName.setName("txtName"); // NOI18N

        calStart.setName("calStart"); // NOI18N

        calEnd.setName("calEnd"); // NOI18N

        javax.swing.ActionMap actionMap = org.jdesktop.application.Application.getInstance().getContext().getActionMap(FrmAddSchoolYear.class, this);
        cmdCancel.setAction(actionMap.get("cancel")); // NOI18N
        cmdCancel.setText("Cancel");
        cmdCancel.setName("cmdCancel"); // NOI18N

        cmdSave.setAction(actionMap.get("save")); // NOI18N
        cmdSave.setText(" Save");
        cmdSave.setName("cmdSave"); // NOI18N

        cmdReset.setAction(actionMap.get("reset")); // NOI18N
        cmdReset.setText("Reset");
        cmdReset.setName("cmdReset"); // NOI18N

        lblStart.setText("Start Date:");
        lblStart.setName("lblStart"); // NOI18N

        lblEnd.setText("End Date:");
        lblEnd.setName("lblEnd"); // NOI18N

        javax.swing.GroupLayout wrapperPanelLayout = new javax.swing.GroupLayout(wrapperPanel);
        wrapperPanel.setLayout(wrapperPanelLayout);
        wrapperPanelLayout.setHorizontalGroup(
            wrapperPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(wrapperPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(wrapperPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(wrapperPanelLayout.createSequentialGroup()
                        .addGroup(wrapperPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblName)
                            .addComponent(lblStart)
                            .addComponent(lblEnd))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(wrapperPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(calEnd, javax.swing.GroupLayout.DEFAULT_SIZE, 286, Short.MAX_VALUE)
                            .addComponent(txtName, javax.swing.GroupLayout.DEFAULT_SIZE, 286, Short.MAX_VALUE)
                            .addComponent(calStart, javax.swing.GroupLayout.DEFAULT_SIZE, 286, Short.MAX_VALUE)))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, wrapperPanelLayout.createSequentialGroup()
                        .addComponent(cmdReset)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 138, Short.MAX_VALUE)
                        .addComponent(cmdSave)
                        .addGap(18, 18, 18)
                        .addComponent(cmdCancel)))
                .addContainerGap())
        );
        wrapperPanelLayout.setVerticalGroup(
            wrapperPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(wrapperPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(wrapperPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblName)
                    .addComponent(txtName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(wrapperPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(calStart, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblStart))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(wrapperPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(lblEnd)
                    .addComponent(calEnd, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(wrapperPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cmdCancel)
                    .addComponent(cmdSave)
                    .addComponent(cmdReset))
                .addContainerGap())
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(wrapperPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(wrapperPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    @Action
    public void reset()
    {
        remove(wrapperPanel);
        initComponents();
        populateLists();
    }
    
    @Action
    public void cancel()
    {
        Utilities.showCancelScreen(this);
    }
    
    @Action
    public void save()
    {
        if (!passedValidation())
        {
            Utilities.showWarningMessage(rootPane,validationText);
            return;
        }
        
        HashMap<String, String> params = new HashMap<String, String>();
        params.put("syName", txtName.getText().trim());
        params.put("syStartDate", Utilities.YMD_Formatter.format(calStart.getDate()));
        params.put("syEndDate", Utilities.YMD_Formatter.format(calEnd.getDate()));
        boolean addSchoolYear = SchoolYear.addSchoolYear(params);
        
        if (addSchoolYear)
        {
            String message = "The school year was successfully added.";
            Utilities.showInfoMessage(rootPane, message);
            reset();
        }
        else
        {
            String message = "An error occurred while trying to add the new school year.\n"
                    + "Kindly verify your information and try again.";
            Utilities.showWarningMessage(rootPane, message);
        }
    }
    
    private boolean passedValidation()
    {
        boolean passed = true ;
        validationText = "";
        
        if (txtName.getText().trim().isEmpty())
        {
            validationText += "You must enter a name for the new school year.\n\n" ;
            passed = false;
        }
        
        return passed;
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private com.toedter.calendar.JDateChooser calEnd;
    private com.toedter.calendar.JDateChooser calStart;
    private javax.swing.JButton cmdCancel;
    private javax.swing.JButton cmdReset;
    private javax.swing.JButton cmdSave;
    private javax.swing.JLabel lblEnd;
    private javax.swing.JLabel lblName;
    private javax.swing.JLabel lblStart;
    private javax.swing.JTextField txtName;
    private javax.swing.JPanel wrapperPanel;
    // End of variables declaration//GEN-END:variables
}
